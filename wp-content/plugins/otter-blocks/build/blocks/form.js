!function(){"use strict";let e=null;const t=e=>{const t=[...e?.querySelectorAll(":scope > .otter-form__container .wp-block-themeisle-blocks-form")];return[...e?.querySelectorAll(":scope > .otter-form__container .wp-block-themeisle-blocks-form-input, :scope > .otter-form__container .wp-block-themeisle-blocks-form-textarea, :scope > .otter-form__container .wp-block-themeisle-blocks-form-multiple-choice, :scope > .otter-form__container .wp-block-themeisle-blocks-form-file")].filter((e=>!t?.some((t=>t?.contains(e)))))},o=async(o,i,s)=>{const r=o?.id,n={},{formFieldsData:l}=await(async e=>{const o=[{label:window?.themeisleGutenbergForm?.messages["form-submission"]||"Form submission from",value:window.location.href,metadata:{position:0}}];return t(e)?.forEach(((e,t)=>{const i=e.querySelector(".otter-form-input-label"),s=(null!=i?i:e).querySelector(".otter-form-input-label__label, .otter-form-textarea-label__label"),r=`(Field ${t+1}) ${(null!=s?s:i)?.innerHTML?.replace(/<[^>]*>?/gm,"")}`;let n,l;const{id:a}=e,c=e.querySelector('.otter-form-input:not([type="checkbox"], [type="radio"], [type="file"]), .otter-form-textarea-input');if(null!==c)n=c?.value,l=c?.type;else{const i=e.querySelector("select"),s=e.querySelector('input[type="file"]');if(s){const e=s?.files;for(let i=0;i<e.length;i++)o.push({label:r,value:`${e[i].name} (${(e[i].size/1048576).toFixed(4)} MB)`,type:s.type,id:a,metadata:{version:1,name:e[i].name,size:e[i].size,file:e[i],fieldOptionName:s?.dataset?.fieldOptionName,position:t+1}})}else if(i)n=[...i.selectedOptions].map((e=>e?.label))?.filter((e=>Boolean(e))).join(", "),l="multiple-choice";else{const t=e.querySelectorAll(".o-form-multiple-choice-field > label"),o=e.querySelectorAll(".o-form-multiple-choice-field > input");n=[...t].filter(((e,t)=>o[t]?.checked)).map((e=>e.innerHTML)).join(", "),l="multiple-choice"}}n&&o.push({label:r||"(No label)",value:n,type:l,id:a,metadata:{version:1,position:t+1}})})),{formFieldsData:o}})(o),a=2>l?.length,c=function(e){const t=`.protection #${e.id||""}_nonce_field`;return e.querySelector(t)?.value}(o),d=o?.classList?.contains("has-captcha"),m=r&&window.themeisleGutenberg?.tokens?.[r]?.token,u=document.createElement("span");if(u.classList.add("spinner"),i.appendChild(u),a)return i.disabled=!1,void i.removeChild(u);const h=function(e){let o=!0;const i=t(e);for(const e of i)if(e.classList.contains("wp-block-themeisle-blocks-form-input")){const t=e.querySelector("input");if(!t?.checkValidity()){t?.reportValidity(),o=!1;break}}else if(e.classList.contains("wp-block-themeisle-blocks-form-textarea")){const t=e.querySelector("textarea");if(!t?.checkValidity()){t?.reportValidity(),o=!1;break}}else if(e.classList.contains("wp-block-themeisle-blocks-form-multiple-choice")){const t=e.querySelector("select");if(t?.hasAttribute("required")&&!t?.checkValidity()){t?.reportValidity(),o=!1;break}const i=e.querySelectorAll('.o-form-multiple-choice-field input[type="radio"]');if(i?.length&&i[0]?.hasAttribute("required")&&![...i].some((e=>e.checked))){i[0]?.reportValidity(),o=!1;break}const s=e.querySelectorAll('.o-form-multiple-choice-field input[type="checkbox"]');if(s?.length&&s[0]?.hasAttribute("required")&&![...s].some((e=>e.checked))){s[0]?.reportValidity(),o=!1;break}}else if(e.classList.contains("wp-block-themeisle-blocks-form-file")){const t=e.querySelector("input");if(!t?.checkValidity()){t?.reportValidity(),o=!1;break}}return o}(o);if(d&&!m){const e=window.hasOwnProperty("grecaptcha")?"check-captcha":"captcha-not-loaded";s.pullMsg(e,"error").show()}if(!h||d&&!m)i.disabled=!1,i.removeChild(u);else{var p,b;n.formInputsData=l,m&&(n.token=window.themeisleGutenberg?.tokens?.[r].token),""!==o?.dataset?.emailSubject&&(n.emailSubject=o?.dataset?.emailSubject),o?.dataset?.optionName&&(n.formOption=o?.dataset?.optionName),o?.id&&(n.formId=o?.id),c&&(n.nonceValue=c),n.antiSpamTime=Date.now()-(null!==(p=e)&&void 0!==p?p:Date.now()),n.antiSpamHoneyPot=Boolean(null!==(b=o.querySelector(":scope > .otter-form__container > .protection .o-anti-bot")?.checked)&&void 0!==b&&b),n.postUrl=window.location.href,n.postId=(()=>{const e=document.querySelector("body")?.classList?.value?.split(" "),t=e?.find((e=>e.includes("postid-")||e.includes("page-id-")));if(t){const e=t.split("-").pop();if(e)return parseInt(e)}return 0})(),o.classList.contains("can-submit-and-subscribe")&&(n.action="submit-subscribe",n.consent=o.querySelector(".otter-form-consent input")?.checked||!1);const t=(window?.themeisleGutenbergForm?.root||window.location.origin+"/wp-json/")+"otter/v1/form/frontend",a=(e=>{var t=new FormData,o=[];return e?.payload?.formInputsData?.forEach(((t,i)=>{if("file"===t.type){let s="file__"+t.metadata.position+"_"+i;o.push([s,t.metadata.file]),e.payload.formInputsData[i].metadata.file=void 0,e.payload.formInputsData[i].metadata.data=s}})),t.append("form_data",JSON.stringify(e)),o.forEach((e=>t.append(e[0],e[1]))),t})({handler:"submit",payload:n});fetch(t,{method:"POST",headers:{"X-WP-Nonce":window?.themeisleGutenbergForm?.nonce},credentials:"include",body:a}).then((e=>e.json())).then((e=>{const t=e;if("0"===t?.code||"1"===t?.code||t?.success){const e=t?.submitMessage?t.submitMessage:"Success";s.setMsg(e).show(),o?.querySelector("form")?.reset(),setTimeout((()=>{if(0<t?.redirectLink?.length){let e=document.createElement("a");e.target="_blank",e.href=t.redirectLink,e.click()}}),1e3)}else{let e="";"110"===t.code?s.setMsg(t?.reasons?.join(""),"error").show():"12"===t.code||"13"===t.code?s.pullMsg("invalid-file","error").show():0<t?.displayError?.length?(e=t?.displayError,s.setMsg(e,"error").show()):s.setMsg(t?.reasons?.join(""),"error").show(),console.error(`(${t?.code}) ${t?.reasons?.join("")}`)}window.themeisleGutenberg?.tokens?.[r].reset&&window.themeisleGutenberg?.tokens?.[r].reset(),i.disabled=!1,i.removeChild(u)}))?.catch((e=>{console.error(e),s.pullMsg("try-again","error").show(),window.themeisleGutenberg?.tokens?.[r].reset&&window.themeisleGutenberg?.tokens?.[r].reset(),i.disabled=!1,i.removeChild(u)}))}};var i;i=()=>{const i=document.querySelectorAll(".wp-block-themeisle-blocks-form");(e=>{if(!window.hasOwnProperty("grecaptcha")&&window?.themeisleGutenbergForm?.reRecaptchaSitekey){const t=document.createElement("script");t.id="recaptcha",document.body.appendChild(t),t.addEventListener("load",(()=>{const t=setInterval((()=>{window.hasOwnProperty("grecaptcha")&&window.grecaptcha.hasOwnProperty("render")&&(e.forEach((e=>{e?.classList?.contains("has-captcha")&&(e=>{if(!window.hasOwnProperty("grecaptcha"))return;const{id:t}=e,o=document.createElement("div"),i=e.querySelector(".otter-form__container");i?.insertBefore(o,i.lastChild);const s=window.grecaptcha?.render(o,{sitekey:window?.themeisleGutenbergForm?.reRecaptchaSitekey,callback:e=>{window.themeisleGutenberg||(window.themeisleGutenberg={}),window.themeisleGutenberg?.tokens||(window.themeisleGutenberg.tokens={}),window.themeisleGutenberg.tokens[t]={token:e,reset:()=>window.grecaptcha?.reset(s)}},"expired-callback":()=>{window.themeisleGutenberg?.tokens||(window.themeisleGutenberg={},window.themeisleGutenberg.tokens={}),window.themeisleGutenberg.tokens[t]={token:null,reset:()=>null}}})})(e)})),clearInterval(t))}),200)})),t.src=window?.themeisleGutenbergForm?.reRecaptchaAPIURL}})(i),e=Date.now(),i.forEach((e=>{e.classList.contains("can-submit-and-subscribe")&&(e=>{const t=e.querySelector(".otter-form__container"),o=e.querySelector(".wp-block-button"),i=document.createElement("div");i.classList.add("otter-form-consent"),t.insertBefore(i,o);const s=document.createElement("input");s.type="checkbox",s.name="o-consent",s.id="o-consent";const r=document.createElement("label");r.innerHTML=window?.themeisleGutenbergForm?.messages?.privacy||"I have read and agreed the privacy statement.",r.htmlFor="o-consent",i.appendChild(s),i.appendChild(r)})(e);const t=e.querySelector("button"),i=new class{constructor(e){this.form=e,this.anchor=e.querySelector(".wp-block-button"),this.anchor?.classList.add("has-submit-msg"),this.msgElem=document.createElement("div"),this.msgElem.classList.add("o-form-server-response"),this.anchor.appendChild(this.msgElem),this.isVisible=!1,this.visibilityTimeout=void 0,this.visibilityDuration=12e3}toggle(e){this.isVisible=void 0!==e?e:!this.isVisible,this.msgElem.style.display=this.isVisible?"block":"none"}pullMsg(e,t){return this.setMsg(window?.themeisleGutenbergForm?.messages[e]||"Messages are missing!",t)}setMsg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(this.msgElem.innerHTML=e,this.clean(),t){case"error":this.msgElem.classList.toggle("o-error",!0);break;case"warning":this.msgElem.classList.toggle("o-warning",!0);break;default:this.msgElem.classList.toggle("o-success",!0)}return this}show(e){clearTimeout(this.visibilityTimeout),this.toggle(!0),this.visibilityTimeout=setTimeout((()=>{this.toggle(!1)}),e||this.visibilityDuration)}clean(){this.msgElem.classList.toggle("o-error",!1),this.msgElem.classList.toggle("o-warning",!1),this.msgElem.classList.toggle("o-success",!1)}}(e);e.querySelector(':scope > form > button[type="submit"]')?e?.addEventListener("submit",(s=>{s.preventDefault(),t.disabled||(t.disabled=!0,o(e,t,i))}),!1):t?.addEventListener("click",(s=>{s.preventDefault(),t.disabled||(t.disabled=!0,o(e,t,i))}),!1)})),i.forEach((e=>{t(e).forEach((e=>{const t=e.querySelector("input");if("file"===t?.type){const{maxFilesNumber:e,maxFileSize:o}=t.dataset;t.addEventListener("change",(i=>{let s=!0;const{files:r}=i.target;if(e&&r.length>e&&(t.setCustomValidity(window.themeisleGutenbergForm?.messages?.["too-many-files"]+e),s=!1),s&&o)for(const e of r)if(e.size>1024*o*1024){t.setCustomValidity(window.themeisleGutenbergForm?.messages?.["big-file"]+" "+o+"MB."),s=!1;break}s?t.setCustomValidity(""):(t.reportValidity(),t.value="")}))}}))}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",i):i())}();